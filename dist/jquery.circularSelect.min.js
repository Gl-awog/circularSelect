!function(a){"use strict";function b(b,c){this.$el=a(b),this.opts=c,this.wrapperClass="circular-wrap",this.$wrapper=a("<div></div>").attr("class",this.wrapperClass),this.choiceClass="circular-choice",this.$choice=a("<button></button>").attr("class",this.choiceClass),this.choiceSpanClass="circular-txt",this.$choiceSpan=a("<span></span>").attr("class",this.choiceSpanClass),this.dropDownClass="circular-dropdown",this.$dropDown=a("<div></div>").attr("class",this.dropDownClass),this.optListClass="circular-optlist",this.$optList=a("<ul></ul>").attr("class",this.optListClass),this.isOpen=!1}b.prototype={constructor:b,_init:function(){this.$descendants=this.$el.find("option,optgroup");var a=document.createDocumentFragment(),b="",c=this.$el.attr("name");this.$descendants.each(function(d,e){var f=document.createElement("li");"option"==e.tagName.toLowerCase()?(f.innerHTML=e.text,f.setAttribute("val",e.value),f.setAttribute("id",c+"_option_"+d),e.selected&&(f.className="selected-li",b=f.innerHTML)):"optgroup"==e.tagName.toLowerCase()&&(f.className="circular-optgroup",f.innerHTML=e.getAttribute("label")),a.appendChild(f)}),this.$optList.append(a),this.$dropDown.append(this.$optList),this.$el.parent("."+this.wrapperClass).length||this.$el.wrap(this.$wrapper),this.$wrapper.find("."+this.choiceClass).length||("auto"!=this.opts.choiceBgColor&&this.$choice.css({background:this.opts.choiceBgColor}),this.$choice.append(this.$choiceSpan),this.$el.after(this.$choice)),this.$choiceSpan.html(b),this.$choice.after(this.$dropDown),this.$li=this.$optList.children("li"),this.liCnt=this.$li.length,this._adjustDimensions(),this.$el.hide(),this.isAnimating=!1,this.redrawing||this._bindEvents()},_bindEvents:function(){var b=this;this.$choice.on("click.circularSelect",function(){b.isOpen?b.hide():b.isAnimating||b.show()}),this.$dropDown.on("click.circularSelect","li:not(.circular-optgroup)",function(c){var d=a(this).attr("val");b.$el.val(d),b.refreshVal(),b.hide()}),a("body").on("click.circularSelect",function(c){var d=a(c.target).closest(".circular-wrap").find("select");d.length&&d.get(0)===b.$el.get(0)||(b.isOpen?b.hide():b.isAnimating&&(b.dfd=a.Deferred(),b.dfd.done(function(){b.hide()})))}).on("change.circularSelect",this.$el,a.proxy(b.refreshVal,b))},refreshVal:function(){var a=this.$el.find(":selected"),b=a.text(),c=a.val();this.$choiceSpan.html(b),this.$li.filter("[val='"+c+"']").addClass("selected-li").siblings().removeClass("selected-li")},_adjustDimensions:function(){var a=this,b=this.$el.get(0).offsetWidth-20,c="auto"==this.opts.dropdownOptionWidth||isNaN(this.opts.dropdownOptionWidth)?b:this.opts.dropdownOptionWidth,d=function(){var b=0;return b="auto"==a.opts.choiceWidth||isNaN(a.opts.choiceWidth)?c:a.opts.choiceWidth}();this.diameter=c,this.$dropDown.css({width:c+"px"}),this.$li.css({width:c+"px",height:c+"px"}),this.$choice.css({width:d+"px",height:d+"px"})},show:function(){var b=this,c=this.opts.adjuster,d=(this.$li.first().height()-c,this.opts.showTime),e=0,f=this.opts.showEasing?this.opts.showEasing:"linear",g=this.opts.diagonalDegree*Math.PI/180;this.prevTops=[0],this.prevLefts=[0],this.isOpen||(this.$dropDown.show().css({top:"0px"}),this.$choice.addClass("clicked"),this._optionColorize(),this.isAnimating=!0,this.$li.each(function(h,i){var j=a(i),k=j.height();e=b.opts.delayShowAcceleration?b.opts.delayShowAcceleration(e,d,h):h*d;var l=(h+1)*(k-c),m=l*Math.sin(g),n=l*Math.cos(g);b.prevTops.push(m),b.prevLefts.push(n),j.delay(e).queue(function(){a(this).css({"z-index":b.liCnt-h,top:b.prevTops[h]+"px",left:b.prevLefts[h]+"px"}).dequeue()}).show(),b.opts.warpText&&b._optionCssWarp(j,0),j.animate({top:m+"px",left:n+"px"},d,f,function(){a(this).next().css({top:m+"px",left:n+"px"})})}),this.$li.promise().done(function(){b.isOpen=!0,b.isAnimating=!1,b.$choice.removeClass("clicked"),b.dfd&&b.dfd.resolve()}))},_optionColorize:function(){var b=this;if(this.opts.colorBlend){var c="auto"!=b.opts.colorBlendSaturation?b.opts.colorBlendSaturation:Math.floor(100*Math.random())+1+"%",d="auto"!=b.opts.colorBlendLightness?b.opts.colorBlendLightness:Math.floor(100*Math.random())+1+"%",e=Math.floor(360*Math.random())+1;if("auto"!==this.opts.colorBlendStartColor&&"string"==typeof this.opts.colorBlendStartColor){var f=this.opts.colorBlendStartColor.trim(),g=/^rgb\((\d+),(\d+),(\d+)\)$/i,h=/^#([0-9A-F]{6})$/i,i=net.brehaut.Color;"function"==typeof i&&(g.exec(f)||h.exec(f))&&(e=new i(f).getHue())}var j=this.opts.colorBlendAngle;this.$li.each(function(f,g){var h=a(this),i="hsl("+(e+j*f)+","+c+","+d+")";"auto"!==b.opts.colorBlendStartColor&&h.attr("bg-color")&&(i=h.attr("bg-color")),h.css({background:i}).attr("bg-color",i)})}},_optionCssWarp:function(a,b){var c=this;return!a.attr("text-warp")&&window.cssWarp&&(this.opts.warpTextSet.warpTextSerif&&a.css({"font-family":"Times New Roman,Georgia,serif"}),cssWarp({path:{radius:c.diameter/2-10,angle:180-(90-c.opts.diagonalDegree)+"deg",textPosition:"inside"},targets:"#"+a.attr("id"),indent:this.opts.warpTextSet.indent,kerning:this.opts.warpTextSet.kerning,rotationMode:this.opts.warpTextSet.rotationMode,align:this.opts.warpTextSet.align,css:this.opts.warpTextSet.css}),a.attr("text-warp",!0)),a},hide:function(){var b=this,c=this.opts.hideTime,d=a(this.$li.get().reverse()),e=0,f=this.opts.hideEasing?this.opts.hideEasing:"linear";this.isOpen&&(this.$choice.addClass("clicked"),d.each(function(d,g){var h=b.prevTops[b.prevTops.length-1-(d+1)],i=b.prevLefts[b.prevLefts.length-1-(d+1)];e=b.opts.delayHideAcceleration?b.opts.delayHideAcceleration(e,c,d):d*c,a(g).delay(e).animate({top:h+"px",left:i+"px"},c,f,function(){a(this).hide().css({top:0,left:0})})}),d.promise().done(function(){b.isOpen=!1,b.$choice.removeClass("clicked")}))},redraw:function(){this.$optList.remove(),this.$li.remove(),this.redrawing=!0,this._init()}},a.fn.circularSelect=function(c){return this.each(function(){var d=a(this),e=d.data("circularSelect"),f=a.extend({},a.fn.circularSelect.defaults,"object"==typeof c&&c);if(e){if("string"==typeof c){var g=["redraw","show","hide","refreshVal"];a.inArray(c,g)>-1&&c in e&&e[c].call(e)}}else e=new b(this,f),d.data("circularSelect",e),e._init()})},a.fn.circularSelect.defaults={choiceWidth:100,dropdownOptionWidth:100,adjuster:50,showTime:300,hideTime:100,diagonalDegree:90,delayShowAcceleration:function(a,b,c){return a+=b*Math.exp(-.3*c)},delayHideAcceleration:function(a,b,c){return a+=b*Math.exp(.02*c)},showEasing:"easeOutQuart",hideEasing:"easeInQuart",colorBlend:!0,colorBlendStartColor:"auto",colorBlendAngle:12,colorBlendSaturation:"100%",colorBlendLightness:"50%",choiceBgColor:"auto",warpText:!0,warpTextSet:{warpTextSerif:!0,indent:"0px",kerning:"0px",rotationMode:"rotate",align:"center",css:""}}}(jQuery);